#!/usr/bin/env node

const { execFileSync } = require("child_process");

const PLATFORMS = {
  "darwin-arm64": "@aemi-cli/darwin-arm64",
  "darwin-x64": "@aemi-cli/darwin-x64",
  "linux-arm64": "@aemi-cli/linux-arm64",
  "linux-x64": "@aemi-cli/linux-x64",
};

const key = `${process.platform}-${process.arch}`;
const pkg = PLATFORMS[key];

if (!pkg) {
  console.error(`Unsupported platform: ${key}`);
  process.exit(1);
}

let binPath;
try {
  binPath = require.resolve(`${pkg}/bin/aemi`);
} catch {
  console.error(
    `Could not find the binary for your platform (${key}).\n` +
      `Expected package: ${pkg}\n\n` +
      `Try reinstalling: npm install aemi`
  );
  process.exit(1);
}

execFileSync(binPath, process.argv.slice(2), { stdio: "inherit" });
